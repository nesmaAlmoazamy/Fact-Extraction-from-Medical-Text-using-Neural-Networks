{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "import csv\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "from keras.preprocessing.text import Tokenizer\n",
    "from keras.preprocessing.sequence import pad_sequences\n",
    "import pickle"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "DS = pd.read_csv(\"ObjectSubset150SentenceLength.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "DS['tag'].fillna('O', inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "27741"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "words = list(set(DS[\"word\"].values))\n",
    "n_words = len(words)\n",
    "n_words"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "2"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "tags = list(set(DS[\"tag\"].values))\n",
    "n_tags = len(tags); n_tags\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['O', 'object']"
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "tags"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "class SentenceGetter(object):\n",
    "    \n",
    "    def __init__(self, data):\n",
    "        self.n_sent = 1\n",
    "        self.data = data\n",
    "        self.empty = False\n",
    "        agg_func = lambda s: [(w, t) for w, t in zip(s[\"word\"].values.tolist(),\n",
    "                                                           s[\"tag\"].values.tolist())]\n",
    "        self.grouped = self.data.groupby(\"text_ID\").apply(agg_func)\n",
    "        self.sentences = [s for s in self.grouped]\n",
    "    \n",
    "    def get_next(self):\n",
    "        try:\n",
    "            s = self.grouped[\"Sentence: {}\".format(self.n_sent)]\n",
    "            self.n_sent += 1\n",
    "            return s\n",
    "        except:\n",
    "            return None"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [],
   "source": [
    "getter = SentenceGetter(DS)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "sentences = getter.sentences\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'26.05.09 patsient hospitaliseeritud erütrotsüütide ülekandeks, 2 doosi RR 120/85 temperatuur 37.7. Võetud vereanalüüsid. Enesetunne rahuldav.'"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "labels = [[s[1] for s in sent] for sent in sentences]\n",
    "sentences = [\" \".join([s[0] for s in sent]) for sent in sentences]\n",
    "sentences[0]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['O', 'O', 'O', 'O', 'O', 'O', 'O', 'object', 'object', 'O', 'O', 'O', 'O', 'O', 'O']\n"
     ]
    }
   ],
   "source": [
    "print(labels[0])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [],
   "source": [
    "from collections import Counter\n",
    "from keras.preprocessing.sequence import pad_sequences\n",
    "\n",
    "word_cnt = Counter(DS[\"word\"].values)\n",
    "vocabulary = set(w[0] for w in word_cnt.most_common(5000))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [],
   "source": [
    "max_len = 50\n",
    "word2idx = {\"PAD\": 0, \"UNK\": 1}\n",
    "word2idx.update({w: i for i, w in enumerate(words) if w in vocabulary})\n",
    "tag2idx = {t: i for i, t in enumerate(tags)}\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [],
   "source": [
    "idx2word = {i: w for w, i in word2idx.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "X = [[word2idx.get(w, word2idx[\"UNK\"]) for w in s.split()] for s in sentences]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [],
   "source": [
    "X = pad_sequences(maxlen=max_len, sequences=X, padding=\"post\", value=word2idx[\"PAD\"])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "y = [[tag2idx[l_i] for l_i in l] for l in labels]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [],
   "source": [
    "y = pad_sequences(maxlen=max_len, sequences=y, padding=\"post\", value=tag2idx[\"O\"])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.model_selection import train_test_split\n",
    "\n",
    "X_tr, X_te, y_tr, y_te = train_test_split(X, y, test_size=0.1, shuffle=False)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [],
   "source": [
    "from keras.models import Model, Input\n",
    "from keras.layers import LSTM, Embedding, Dense, TimeDistributed, SpatialDropout1D, Bidirectional\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [],
   "source": [
    "word_input = Input(shape=(max_len,))\n",
    "model = Embedding(input_dim=n_words, output_dim=50, input_length=max_len)(word_input)\n",
    "model = SpatialDropout1D(0.1)(model)\n",
    "model = Bidirectional(LSTM(units=100, return_sequences=True, recurrent_dropout=0.1))(model)\n",
    "out = TimeDistributed(Dense(n_tags, activation=\"softmax\"))(model)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [],
   "source": [
    "model = Model(word_input, out)\n",
    "model.compile(optimizer=\"rmsprop\",\n",
    "              loss=\"sparse_categorical_crossentropy\",\n",
    "              metrics=[\"accuracy\"])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\Kasutaja\\Anaconda3\\envs\\myEnv\\lib\\site-packages\\tensorflow_core\\python\\framework\\indexed_slices.py:433: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory.\n",
      "  \"Converting sparse IndexedSlices to a dense Tensor of unknown shape. \"\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Train on 11050 samples, validate on 1228 samples\n",
      "Epoch 1/5\n",
      "11050/11050 [==============================] - 24s 2ms/step - loss: 0.0384 - accuracy: 0.9889 - val_loss: 0.0207 - val_accuracy: 0.9942\n",
      "Epoch 2/5\n",
      "11050/11050 [==============================] - 23s 2ms/step - loss: 0.0099 - accuracy: 0.9970 - val_loss: 0.0146 - val_accuracy: 0.9951\n",
      "Epoch 3/5\n",
      "11050/11050 [==============================] - 23s 2ms/step - loss: 0.0080 - accuracy: 0.9975 - val_loss: 0.0152 - val_accuracy: 0.9952\n",
      "Epoch 4/5\n",
      "11050/11050 [==============================] - 23s 2ms/step - loss: 0.0071 - accuracy: 0.9978 - val_loss: 0.0138 - val_accuracy: 0.9955\n",
      "Epoch 5/5\n",
      "11050/11050 [==============================] - 23s 2ms/step - loss: 0.0066 - accuracy: 0.9980 - val_loss: 0.0116 - val_accuracy: 0.9963\n"
     ]
    }
   ],
   "source": [
    "history = model.fit(X_tr, y_tr.reshape(*y_tr.shape, 1),\n",
    "                    batch_size=32, epochs=5,\n",
    "                    validation_split=0.1, verbose=1)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "# from keras.callbacks import ModelCheckpoint\n",
    "\n",
    "# # Saving the best model only\n",
    "# filepath=\"CharacterEmbeddingObject-{val_accuracy:.2f}.hdf5\"\n",
    "# checkpoint = ModelCheckpoint(filepath, monitor='val_accuracy', verbose=1, save_best_only=True, mode='max')\n",
    "# callbacks_list = [checkpoint]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [],
   "source": [
    "hist = pd.DataFrame(history.history)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 864x864 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "plt.style.use(\"ggplot\")\n",
    "plt.figure(figsize=(12,12))\n",
    "plt.plot(hist[\"accuracy\"])\n",
    "plt.plot(hist[\"val_accuracy\"])\n",
    "plt.show()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [],
   "source": [
    "y_pred = model.predict(X_te)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [],
   "source": [
    "idx2tag = {i: w for w, i in tag2idx.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Word           ||True ||Pred\n",
      "==============================\n",
      "RR             : object object\n",
      "130/80,        : object object\n"
     ]
    }
   ],
   "source": [
    "i = 1006\n",
    "p = np.argmax(y_pred[i], axis=-1)\n",
    "print(\"{:15}||{:5}||{}\".format(\"Word\", \"True\", \"Pred\"))\n",
    "print(30 * \"=\")\n",
    "for w, t, pred in zip(X_te[i], y_te[i], p):\n",
    "    if t != 0: #PAD\n",
    "        print(\"{:15}: {:5} {}\".format(idx2word[w], idx2tag[t], idx2tag[pred]))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "len(y_pred)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Wrong Tags\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "112/70         : O     object\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "120/85         : object O\n",
      "kontrolli,     : O     object\n",
      "RR120/70mmHg   : object O\n",
      "pigem          : O     object\n",
      "RR140/90       : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "kontroll       : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "rütmi          : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "78,            : O     object\n",
      "korras         : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "kontroll.      : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "mõõta          : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "mõõta          : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "ravimi         : O     object\n",
      "UNK            : object O\n",
      "108/60         : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "RR.            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "RR.            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "150/80         : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "130/80         : object O\n",
      "UNK            : object O\n",
      "kõrgem.        : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "Obj:RR         : object O\n",
      "Obj:RR         : object O\n",
      "150            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "kontrollima    : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "endiselt       : O     object\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "mõõta          : O     object\n",
      "UNK            : object O\n",
      "kuni           : O     object\n",
      "kuni           : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "pigem          : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : O     object\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "tõuseb         : O     object\n",
      "160/90         : O     object\n",
      "kuni           : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "78,            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "RR.            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "ravimit        : O     object\n",
      "nüüd           : O     object\n",
      "nüüd           : O     object\n",
      "UNK            : object O\n",
      "regul,RR       : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "108/60         : object O\n",
      "mõõta          : O     object\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "kontrollima.   : O     object\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "kontrollima    : O     object\n",
      "UNK            : object O\n",
      "159            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "160/90         : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "kontroll,      : O     object\n",
      "*06.07.2015    : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "UNK            : object O\n",
      "ravim          : O     object\n",
      "UNK            : object O\n",
      "UNK            : object O\n"
     ]
    }
   ],
   "source": [
    "j = 0\n",
    "for i in range(len(y_pred)):\n",
    "    p = np.argmax(y_pred[i], axis=-1)\n",
    "#     print(\"{:15}||{:5}||{}\".format(\"Word\", \"True\", \"Pred\"))\n",
    "#     print(30 * \"=\")\n",
    "    for w, t, pred in zip(X_te[i], y_te[i], p):\n",
    "        if idx2word[w] != \"\": #PAD\n",
    "            if idx2tag[t] != idx2tag[pred]:\n",
    "                print(\"{:15}: {:5} {}\".format(idx2word[w], idx2tag[t], idx2tag[pred]))\n",
    "                j = j+1\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "314"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "j"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "F1-score: 87.2%\n",
      "           precision    recall  f1-score   support\n",
      "\n",
      "   object       0.92      0.83      0.87      1519\n",
      "\n",
      "micro avg       0.92      0.83      0.87      1519\n",
      "macro avg       0.92      0.83      0.87      1519\n",
      "\n"
     ]
    }
   ],
   "source": [
    "from seqeval.metrics import accuracy_score, precision_score, recall_score, f1_score, classification_report\n",
    "\n",
    "def pred2label(pred):\n",
    "    out = []\n",
    "    for pred_i in pred:\n",
    "        out_i = []\n",
    "        for p in pred_i:\n",
    "            p_i = np.argmax(p)\n",
    "            out_i.append(idx2tag[p_i].replace(\"PAD\", \"text\"))\n",
    "        out.append(out_i)\n",
    "    return out\n",
    "\n",
    "def test2label(pred):\n",
    "    out = []\n",
    "    for pred_i in pred:\n",
    "        out_i = []\n",
    "        for p in pred_i:\n",
    "            out_i.append(idx2tag[p].replace(\"PAD\", \"text\"))\n",
    "        out.append(out_i)\n",
    "    return out\n",
    "\n",
    "pred_labels = pred2label(y_pred)\n",
    "test_labels = test2label(y_te)\n",
    "\n",
    "print(\"F1-score: {:.1%}\".format(f1_score(test_labels, pred_labels)))\n",
    "print(classification_report(test_labels, pred_labels))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.9953992673992674"
      ]
     },
     "execution_count": 67,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "accuracy_score(test_labels, pred_labels)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 68,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "              precision    recall  f1-score   support\n",
      "\n",
      "           O       1.00      1.00      1.00     65536\n",
      "      object       0.97      0.91      0.94      2714\n",
      "\n",
      "    accuracy                           1.00     68250\n",
      "   macro avg       0.98      0.95      0.97     68250\n",
      "weighted avg       1.00      1.00      1.00     68250\n",
      "\n",
      "Accuracy 0.9953992673992674\n"
     ]
    }
   ],
   "source": [
    "from sklearn_crfsuite.metrics import flat_classification_report,flat_accuracy_score\n",
    "report = flat_classification_report(y_pred=pred_labels, y_true=test_labels)\n",
    "print(report)\n",
    "print(\"Accuracy\",flat_accuracy_score(y_pred=pred_labels, y_true=test_labels))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Interpretability\n",
    "###### TextExplainer allows to explain predictions of black-box text classifiers using LIME algorithm.\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\Kasutaja\\Anaconda3\\envs\\myEnv\\lib\\site-packages\\sklearn\\utils\\deprecation.py:144: FutureWarning: The sklearn.metrics.scorer module is  deprecated in version 0.22 and will be removed in version 0.24. The corresponding classes / functions should instead be imported from sklearn.metrics. Anything that cannot be imported from sklearn.metrics is now part of the private API.\n",
      "  warnings.warn(message, FutureWarning)\n",
      "C:\\Users\\Kasutaja\\Anaconda3\\envs\\myEnv\\lib\\site-packages\\sklearn\\utils\\deprecation.py:144: FutureWarning: The sklearn.feature_selection.base module is  deprecated in version 0.22 and will be removed in version 0.24. The corresponding classes / functions should instead be imported from sklearn.feature_selection. Anything that cannot be imported from sklearn.feature_selection is now part of the private API.\n",
      "  warnings.warn(message, FutureWarning)\n"
     ]
    }
   ],
   "source": [
    "from eli5.lime import TextExplainer\n",
    "from eli5.lime.samplers import MaskingTextSampler\n",
    "# https://eli5.readthedocs.io/en/latest/autodocs/lime.html"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 70,
   "metadata": {},
   "outputs": [],
   "source": [
    "class NERExplainerGenerator(object):\n",
    "    \n",
    "    def __init__(self, model, word2idx, tag2idx, max_len):\n",
    "        self.model = model\n",
    "        self.word2idx = word2idx\n",
    "        self.tag2idx = tag2idx\n",
    "        self.idx2tag = {v: k for k,v in tag2idx.items()}\n",
    "        self.max_len = max_len\n",
    "        \n",
    "    def _preprocess(self, texts):\n",
    "        X = [[self.word2idx.get(w, self.word2idx[\"UNK\"]) for w in t.split()]\n",
    "             for t in texts]\n",
    "        X = pad_sequences(maxlen=self.max_len, sequences=X,\n",
    "                          padding=\"post\", value=self.word2idx[\"PAD\"])\n",
    "        return X\n",
    "    \n",
    "    def get_predict_function(self, word_index):\n",
    "        def predict_func(texts):\n",
    "            X = self._preprocess(texts)\n",
    "            p = self.model.predict(X)\n",
    "            return p[:,word_index,:]\n",
    "        return predict_func\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 320,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Põhjendus: (O) 6A (O) dünaamikas (O) Kirjeldus: (O) Võrreldes (O) 23.10 (O) tehtud (O) ü/v-ga (O) dünaamika (O) puudub. (O) Pikkus-165, (object) kaal-107,6. (O) v/s-10,5 (O) tühjalt. (O) 29.04.2013 (O) - (O) RR (object) 120/80 (object) mmHg.fr.70 (O) x/min.O2 (O) saturatsioon (O) 100 (O) %,kaal (O) 63 (O) kg.pikkus (O) 168 (O) cm. (O) . (O) Cor (O) toonid (O) arütmilised. (O) Frekvents (O) 87x (O) minutis (O) .RR110/78 (object) mmhg (O) Turseid (O) ei (O) ole (O) . (O) Biokeemia (O) tehtud (O) perearsti (O) poolt (O) . (O)\n"
     ]
    }
   ],
   "source": [
    "Sentneceindex = 21\n",
    "label = labels[20:24]\n",
    "text = sentences[20:24]\n",
    "# print(label)\n",
    "# print(text)\n",
    "\n",
    "text = \" \".join(str(x) for x in text)\n",
    "label = [' '.join(x) for x in label]\n",
    "label = \" \".join(str(x) for x in label)\n",
    "# print(label)\n",
    "# print(text)\n",
    "# # # label = [' '.join(x) for x in label]\n",
    "# label = \" \".join(str(x) for x in label)\n",
    "\n",
    "# print(label)\n",
    "print(\" \".join([f\"{t} ({l})\" for t, l in zip(text.split(), label.split())]))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 274,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "0: Põhjendus:\n",
      "1: 6A\n",
      "2: dünaamikas\n",
      "3: Kirjeldus:\n",
      "4: Võrreldes\n",
      "5: 23.10\n",
      "6: tehtud\n",
      "7: ü/v-ga\n",
      "8: dünaamika\n",
      "9: puudub.\n",
      "10: Pikkus-165,\n",
      "11: kaal-107,6.\n",
      "12: v/s-10,5\n",
      "13: tühjalt.\n",
      "14: 29.04.2013\n",
      "15: -\n",
      "16: RR\n",
      "17: 120/80\n",
      "18: mmHg.fr.70\n",
      "19: x/min.O2\n",
      "20: saturatsioon\n",
      "21: 100\n",
      "22: %,kaal\n",
      "23: 63\n",
      "24: kg.pikkus\n",
      "25: 168\n",
      "26: cm.\n",
      "27: .\n",
      "28: Cor\n",
      "29: toonid\n",
      "30: arütmilised.\n",
      "31: Frekvents\n",
      "32: 87x\n",
      "33: minutis\n",
      "34: .RR110/78\n",
      "35: mmhg\n",
      "36: Turseid\n",
      "37: ei\n",
      "38: ole\n",
      "39: .\n",
      "40: Biokeemia\n",
      "41: tehtud\n",
      "42: perearsti\n",
      "43: poolt\n",
      "44: .\n"
     ]
    }
   ],
   "source": [
    "for i, w in enumerate(text.split()):\n",
    "    print(f\"{i}: {w}\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 275,
   "metadata": {},
   "outputs": [],
   "source": [
    "explainer_generator = NERExplainerGenerator(model, word2idx, tag2idx, max_len)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 276,
   "metadata": {},
   "outputs": [],
   "source": [
    "word_index = 16\n",
    "predict_func = explainer_generator.get_predict_function(word_index=word_index)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 322,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(('UNK: UNK UNK Kirjeldus: UNK 23.UNK tehtud ü/v-ga UNK UNK. Pikkus-UNK, UNK-107,UNK. UNK/UNK-UNK,UNK tühjalt. 29.UNK.UNK - UNK UNK/UNK UNK.UNK.UNK UNK/UNK.UNK saturatsioon UNK %,kaal UNK kg.UNK UNK UNK. . Cor UNK UNK. Frekvents 87x minutis .UNK/UNK UNK UNK ei UNK . UNK UNK UNK UNK .', 'UNK: 6A dünaamikas Kirjeldus: UNK UNK.10 UNK ü/v-ga dünaamika puudub. Pikkus-165, kaal-107,UNK. v/s-10,UNK tühjalt. UNK.04.2013 - RR 120/80 UNK.fr.70 x/min.UNK saturatsioon UNK %,kaal 63 kg.UNK UNK UNK. . Cor toonid UNK. UNK UNK minutis .RR110/78 mmhg Turseid ei ole . Biokeemia tehtud perearsti poolt .', 'Põhjendus: 6A UNK Kirjeldus: Võrreldes 23.UNK UNK ü/v-ga dünaamika puudub. UNK-UNK, kaal-UNK,6. UNK/UNK-UNK,5 tühjalt. UNK.UNK.2013 - RR UNK/80 mmHg.UNK.UNK UNK/min.O2 UNK 100 %,kaal 63 kg.pikkus UNK cm. . UNK UNK UNK. Frekvents 87x minutis .UNK/78 UNK UNK UNK UNK . UNK UNK UNK UNK .', 'Põhjendus: 6A dünaamikas UNK: UNK UNK.UNK tehtud UNK/UNK-ga UNK UNK. Pikkus-165, UNK-UNK,UNK. UNK/UNK-10,UNK UNK. UNK.UNK.2013 - UNK UNK/80 UNK.fr.70 x/min.UNK saturatsioon UNK %,kaal 63 kg.pikkus 168 cm. . Cor toonid UNK. Frekvents UNK minutis .RR110/UNK UNK UNK ei ole . UNK tehtud perearsti poolt .', 'Põhjendus: 6A dünaamikas Kirjeldus: Võrreldes 23.10 UNK UNK/UNK-ga dünaamika UNK. Pikkus-165, kaal-107,6. v/s-UNK,5 tühjalt. 29.UNK.UNK - RR 120/80 mmHg.fr.70 UNK/min.O2 saturatsioon 100 %,kaal 63 UNK.pikkus 168 cm. . Cor toonid arütmilised. Frekvents 87x minutis .RR110/78 mmhg Turseid ei ole . Biokeemia UNK perearsti poolt .', 'UNK: UNK dünaamikas UNK: UNK UNK.10 tehtud UNK/UNK-UNK UNK puudub. Pikkus-165, kaal-UNK,6. v/s-UNK,UNK UNK. UNK.04.2013 - RR UNK/UNK UNK.fr.UNK UNK/min.UNK saturatsioon 100 %,kaal UNK kg.UNK UNK cm. . Cor UNK UNK. UNK 87x minutis .RR110/UNK mmhg UNK UNK ole . Biokeemia UNK UNK UNK .', 'Põhjendus: 6A dünaamikas Kirjeldus: Võrreldes 23.10 tehtud ü/v-ga dünaamika puudub. Pikkus-165, kaal-107,6. v/s-10,5 tühjalt. 29.04.2013 - RR 120/80 mmHg.fr.70 x/min.O2 saturatsioon 100 %,kaal 63 kg.pikkus 168 cm. . Cor toonid arütmilised. Frekvents 87x minutis .RR110/78 mmhg Turseid ei ole . UNK tehtud perearsti poolt .', 'Põhjendus: 6A UNK Kirjeldus: UNK UNK.UNK UNK UNK/UNK-ga UNK UNK. Pikkus-165, UNK-UNK,UNK. v/UNK-UNK,5 UNK. 29.04.2013 - RR UNK/80 mmHg.fr.UNK UNK/UNK.UNK saturatsioon 100 %,UNK UNK UNK.UNK UNK cm. . UNK UNK UNK. Frekvents UNK UNK .UNK/UNK UNK UNK UNK UNK . UNK UNK UNK UNK .', 'Põhjendus: UNK UNK UNK: Võrreldes 23.10 tehtud ü/v-ga dünaamika puudub. Pikkus-165, kaal-UNK,UNK. UNK/s-UNK,5 tühjalt. 29.04.2013 - RR UNK/80 mmHg.fr.UNK x/UNK.UNK saturatsioon 100 %,UNK 63 kg.pikkus 168 cm. . Cor toonid arütmilised. UNK 87x minutis .RR110/78 mmhg Turseid UNK ole . Biokeemia tehtud perearsti poolt .', 'UNK: 6A dünaamikas UNK: UNK 23.UNK UNK UNK/v-ga dünaamika puudub. UNK-UNK, UNK-UNK,UNK. v/UNK-UNK,UNK UNK. UNK.UNK.UNK - UNK 120/UNK UNK.fr.UNK UNK/min.UNK UNK UNK %,UNK UNK UNK.UNK 168 UNK. . Cor toonid UNK. UNK UNK minutis .UNK/UNK mmhg UNK UNK ole . Biokeemia UNK UNK UNK .'), array([0.55234475, 0.85370576, 0.71307401, 0.72486116, 0.91132236,\n",
      "       0.67648141, 0.99148919, 0.56748029, 0.87333375, 0.55234475]))\n"
     ]
    }
   ],
   "source": [
    "sampler = MaskingTextSampler(\n",
    "    replacement=\"UNK\",\n",
    "    max_replace=0.7,\n",
    "    token_pattern=None,\n",
    "    bow=False\n",
    ")\n",
    "print(sampler.sample_near(text, n_samples=10))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 321,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "    <style>\n",
       "    table.eli5-weights tr:hover {\n",
       "        filter: brightness(85%);\n",
       "    }\n",
       "</style>\n",
       "\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "        \n",
       "\n",
       "    \n",
       "\n",
       "        \n",
       "\n",
       "        \n",
       "    \n",
       "        \n",
       "        \n",
       "    \n",
       "        <p style=\"margin-bottom: 0.5em; margin-top: 0em\">\n",
       "            <b>\n",
       "    \n",
       "        y=O\n",
       "    \n",
       "</b>\n",
       "\n",
       "    \n",
       "    (probability <b>0.999</b>, score <b>-7.207</b>)\n",
       "\n",
       "top features\n",
       "        </p>\n",
       "    \n",
       "    <table class=\"eli5-weights\"\n",
       "           style=\"border-collapse: collapse; border: none; margin-top: 0em; table-layout: auto; margin-bottom: 2em;\">\n",
       "        <thead>\n",
       "        <tr style=\"border: none;\">\n",
       "            \n",
       "                <th style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\" title=\"Feature contribution already accounts for the feature value (for linear models, contribution = weight * feature value), and the sum of feature contributions is equal to the score or, for some classifiers, to the probability. Feature values are shown if &quot;show_feature_values&quot; is True.\">\n",
       "                    Contribution<sup>?</sup>\n",
       "                </th>\n",
       "            \n",
       "            <th style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">Feature</th>\n",
       "            \n",
       "        </tr>\n",
       "        </thead>\n",
       "        <tbody>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 80.00%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +4.356\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        Highlighted in text (sum)\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 85.13%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +2.852\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        &lt;BIAS&gt;\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "        \n",
       "\n",
       "        \n",
       "        \n",
       "\n",
       "        </tbody>\n",
       "    </table>\n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n",
       "    <p style=\"margin-bottom: 2.5em; margin-top:-0.5em;\">\n",
       "        <span style=\"background-color: hsl(120, 100.00%, 82.71%); opacity: 0.86\" title=\"0.377\">Põhjendus</span><span style=\"opacity: 0.80\">: </span><span style=\"background-color: hsl(120, 100.00%, 86.37%); opacity: 0.84\" title=\"0.268\">6A</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 91.53%); opacity: 0.82\" title=\"0.136\">dünaamikas</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 73.86%); opacity: 0.91\" title=\"0.680\">Kirjeldus</span><span style=\"opacity: 0.80\">: </span><span style=\"background-color: hsl(120, 100.00%, 93.57%); opacity: 0.81\" title=\"0.092\">Võrreldes</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 92.10%); opacity: 0.82\" title=\"0.123\">23</span><span style=\"opacity: 0.80\">.10 </span><span style=\"background-color: hsl(120, 100.00%, 60.00%); opacity: 1.00\" title=\"1.250\">tehtud</span><span style=\"opacity: 0.80\"> ü/</span><span style=\"background-color: hsl(120, 100.00%, 90.92%); opacity: 0.82\" title=\"0.150\">v</span><span style=\"opacity: 0.80\">-</span><span style=\"background-color: hsl(120, 100.00%, 92.31%); opacity: 0.82\" title=\"0.119\">ga</span><span style=\"opacity: 0.80\"> dünaamika </span><span style=\"background-color: hsl(0, 100.00%, 94.01%); opacity: 0.81\" title=\"-0.083\">puudub</span><span style=\"opacity: 0.80\">. </span><span style=\"background-color: hsl(120, 100.00%, 93.58%); opacity: 0.81\" title=\"0.092\">Pikkus</span><span style=\"opacity: 0.80\">-</span><span style=\"background-color: hsl(120, 100.00%, 96.51%); opacity: 0.81\" title=\"0.038\">165</span><span style=\"opacity: 0.80\">, kaal-</span><span style=\"background-color: hsl(120, 100.00%, 91.00%); opacity: 0.82\" title=\"0.148\">107</span><span style=\"opacity: 0.80\">,</span><span style=\"background-color: hsl(120, 100.00%, 98.33%); opacity: 0.80\" title=\"0.013\">6</span><span style=\"opacity: 0.80\">. v/s-10,5 tühjalt. </span><span style=\"background-color: hsl(120, 100.00%, 96.20%); opacity: 0.81\" title=\"0.043\">29</span><span style=\"opacity: 0.80\">.04.</span><span style=\"background-color: hsl(120, 100.00%, 92.96%); opacity: 0.82\" title=\"0.104\">2013</span><span style=\"opacity: 0.80\"> - </span><span style=\"background-color: hsl(120, 100.00%, 96.23%); opacity: 0.81\" title=\"0.043\">RR</span><span style=\"opacity: 0.80\"> 120/80 mmHg.fr.70 x/min.O2 saturatsioon 100 %,</span><span style=\"background-color: hsl(120, 100.00%, 94.58%); opacity: 0.81\" title=\"0.072\">kaal</span><span style=\"opacity: 0.80\"> 63 kg.pikkus 168 cm. . </span><span style=\"background-color: hsl(120, 100.00%, 96.72%); opacity: 0.81\" title=\"0.035\">Cor</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 91.55%); opacity: 0.82\" title=\"0.136\">toonid</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 96.30%); opacity: 0.81\" title=\"0.042\">arütmilised</span><span style=\"opacity: 0.80\">. Frekvents </span><span style=\"background-color: hsl(120, 100.00%, 93.50%); opacity: 0.81\" title=\"0.093\">87x</span><span style=\"opacity: 0.80\"> minutis .RR110/</span><span style=\"background-color: hsl(120, 100.00%, 91.83%); opacity: 0.82\" title=\"0.129\">78</span><span style=\"opacity: 0.80\"> mmhg </span><span style=\"background-color: hsl(120, 100.00%, 95.11%); opacity: 0.81\" title=\"0.062\">Turseid</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 96.34%); opacity: 0.81\" title=\"0.041\">ei</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 95.88%); opacity: 0.81\" title=\"0.049\">ole</span><span style=\"opacity: 0.80\"> . Biokeemia tehtud </span><span style=\"background-color: hsl(120, 100.00%, 93.03%); opacity: 0.82\" title=\"0.103\">perearsti</span><span style=\"opacity: 0.80\"> poolt .</span>\n",
       "    </p>\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n"
      ],
      "text/plain": [
       "Explanation(estimator=\"SGDClassifier(alpha=0.001, average=False, class_weight=None,\\n              early_stopping=False, epsilon=0.1, eta0=0.0, fit_intercept=True,\\n              l1_ratio=0.15, learning_rate='optimal', loss='log', max_iter=1000,\\n              n_iter_no_change=5, n_jobs=None, penalty='elasticnet',\\n              power_t=0.5, random_state=RandomState(MT19937) at 0x1BB731FF8C8,\\n              shuffle=True, tol=0.001, validation_fraction=0.1, verbose=0,\\n              warm_start=False)\", description=None, error=None, method='linear model', is_regression=False, targets=[TargetExplanation(target='O', feature_weights=FeatureWeights(pos=[FeatureWeight(feature='<BIAS>', weight=2.851643737859112, std=None, value=1.0), FeatureWeight(feature='[7] tehtud', weight=1.2495042699178953, std=None, value=1.0), FeatureWeight(feature='[3] Kirjeldus', weight=0.6804731518974096, std=None, value=1.0), FeatureWeight(feature='[0] Põhjendus', weight=0.3769812724879292, std=None, value=1.0), FeatureWeight(feature='[1] 6A', weight=0.2684663774371928, std=None, value=1.0), FeatureWeight(feature='[9] v', weight=0.150151117388824, std=None, value=1.0), FeatureWeight(feature='[16] 107', weight=0.14827220149004874, std=None, value=1.0), FeatureWeight(feature='[2] dünaamikas', weight=0.13602161420781608, std=None, value=1.0), FeatureWeight(feature='[44] toonid', weight=0.13562437039552117, std=None, value=1.0), FeatureWeight(feature='[50] 78', weight=0.1291547003316592, std=None, value=1.0), FeatureWeight(feature='[5] 23', weight=0.1232329967958402, std=None, value=1.0), FeatureWeight(feature='[10] ga', weight=0.11859687270860182, std=None, value=1.0), FeatureWeight(feature='[25] 2013', weight=0.10439633251366834, std=None, value=1.0), FeatureWeight(feature='[57] perearsti', weight=0.10300275370797378, std=None, value=1.0), FeatureWeight(feature='[47] 87x', weight=0.09320295573963731, std=None, value=1.0), FeatureWeight(feature='[4] Võrreldes', weight=0.09174117512114939, std=None, value=1.0), FeatureWeight(feature='[13] Pikkus', weight=0.0916241536139618, std=None, value=1.0), FeatureWeight(feature='[37] kaal', weight=0.07192800020584722, std=None, value=1.0), FeatureWeight(feature='[52] Turseid', weight=0.06213412296282621, std=None, value=1.0), FeatureWeight(feature='[54] ole', weight=0.048658440116193906, std=None, value=1.0), FeatureWeight(feature='[23] 29', weight=0.04331267887179339, std=None, value=1.0), FeatureWeight(feature='[26] RR', weight=0.042784223339383566, std=None, value=1.0), FeatureWeight(feature='[45] arütmilised', weight=0.041685424103230645, std=None, value=1.0), FeatureWeight(feature='[53] ei', weight=0.04105305764213442, std=None, value=1.0), FeatureWeight(feature='[14] 165', weight=0.038361983739905146, std=None, value=1.0), FeatureWeight(feature='[43] Cor', weight=0.03500564880452398, std=None, value=1.0), FeatureWeight(feature='[17] 6', weight=0.013341748167969467, std=None, value=1.0)], neg=[FeatureWeight(feature='[12] puudub', weight=-0.08296536588060886, std=None, value=1.0)], pos_remaining=0, neg_remaining=0), proba=0.9992594599421792, score=-7.207390015687441, weighted_spans=WeightedSpans(docs_weighted_spans=[DocWeightedSpans(document='Põhjendus: 6A dünaamikas Kirjeldus: Võrreldes 23.10 tehtud ü/v-ga dünaamika puudub. Pikkus-165, kaal-107,6. v/s-10,5 tühjalt. 29.04.2013 - RR 120/80 mmHg.fr.70 x/min.O2 saturatsioon 100 %,kaal 63 kg.pikkus 168 cm. . Cor toonid arütmilised. Frekvents 87x minutis .RR110/78 mmhg Turseid ei ole . Biokeemia tehtud perearsti poolt .', spans=[('Põhjendus', [(0, 9)], 0.3769812724879292), ('6A', [(11, 13)], 0.2684663774371928), ('dünaamikas', [(14, 24)], 0.13602161420781608), ('Kirjeldus', [(25, 34)], 0.6804731518974096), ('Võrreldes', [(36, 45)], 0.09174117512114939), ('23', [(46, 48)], 0.1232329967958402), ('tehtud', [(52, 58)], 1.2495042699178953), ('v', [(61, 62)], 0.150151117388824), ('ga', [(63, 65)], 0.11859687270860182), ('puudub', [(76, 82)], -0.08296536588060886), ('Pikkus', [(84, 90)], 0.0916241536139618), ('165', [(91, 94)], 0.038361983739905146), ('107', [(101, 104)], 0.14827220149004874), ('6', [(105, 106)], 0.013341748167969467), ('29', [(126, 128)], 0.04331267887179339), ('2013', [(132, 136)], 0.10439633251366834), ('RR', [(139, 141)], 0.042784223339383566), ('kaal', [(188, 192)], 0.07192800020584722), ('Cor', [(216, 219)], 0.03500564880452398), ('toonid', [(220, 226)], 0.13562437039552117), ('arütmilised', [(227, 238)], 0.041685424103230645), ('87x', [(250, 253)], 0.09320295573963731), ('78', [(269, 271)], 0.1291547003316592), ('Turseid', [(277, 284)], 0.06213412296282621), ('ei', [(285, 287)], 0.04105305764213442), ('ole', [(288, 291)], 0.048658440116193906), ('perearsti', [(311, 320)], 0.10300275370797378)], preserve_density=False, vec_name=None)], other=FeatureWeights(pos=[FeatureWeight(feature=<FormattedFeatureName 'Highlighted in text (sum)'>, weight=4.355746277828327, std=None, value=None), FeatureWeight(feature='<BIAS>', weight=2.851643737859112, std=None, value=1.0)], neg=[], pos_remaining=0, neg_remaining=0)), heatmap=None)], feature_importances=None, decision_tree=None, highlight_spaces=None, transition_features=None, image=None)"
      ]
     },
     "execution_count": 321,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "te = TextExplainer(\n",
    "    sampler=sampler,\n",
    "    position_dependent=True,\n",
    "    random_state=42,\n",
    "#     char_based =True #True if explanation should be char-based, False if it should be token-based. Default is False.\n",
    ")\n",
    "\n",
    "te.fit(text, predict_func)\n",
    "\n",
    "te.explain_prediction(\n",
    "    target_names=list(explainer_generator.idx2tag.values())\n",
    "   \n",
    ")\n",
    "# https://github.com/TeamHG-Memex/eli5/blob/017c738f8dcf3e31346de49a390835ffafad3f1b/eli5/explain.py#L83\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 323,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Üldseisund: rahuldav 156 cm,90 kg Kardiovaskulaarsüsteem: RR 140/80 mmHg,fr reg 72 x min RR130/100 mmHg. Obj. liigesturset ei ole, k.a. MTP-des. RR 160/80 mmHg, kaal 131,1 kg, eutüreoidne, kilpnääre palp.tundub veidi tihedam normist, võimalik nodoosne.\n",
      "Üldseisund: (O) rahuldav (O) 156 (O) cm,90 (O) kg (O) Kardiovaskulaarsüsteem: (O) RR (object) 140/80 (object) mmHg,fr (O) reg (O) 72 (O) x (O) min (O) RR130/100 (object) mmHg. (O) Obj. (O) liigesturset (O) ei (O) ole, (O) k.a. (O) MTP-des. (O) RR (object) 160/80 (object) mmHg, (O) kaal (O) 131,1 (O) kg, (O) eutüreoidne, (O) kilpnääre (O) palp.tundub (O) veidi (O) tihedam (O) normist, (O) võimalik (O) nodoosne. (O)\n"
     ]
    }
   ],
   "source": [
    "label = labels[196:201]\n",
    "text = sentences[196:201]\n",
    "text = \" \".join(str(x) for x in text)\n",
    "label = [' '.join(x) for x in label]\n",
    "label = \" \".join(str(x) for x in label)\n",
    "print(text)\n",
    "print(\" \".join([f\"{t} ({l})\" for t, l in zip(text.split(), label.split())]))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 324,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "0: Üldseisund:\n",
      "1: rahuldav\n",
      "2: 156\n",
      "3: cm,90\n",
      "4: kg\n",
      "5: Kardiovaskulaarsüsteem:\n",
      "6: RR\n",
      "7: 140/80\n",
      "8: mmHg,fr\n",
      "9: reg\n",
      "10: 72\n",
      "11: x\n",
      "12: min\n",
      "13: RR130/100\n",
      "14: mmHg.\n",
      "15: Obj.\n",
      "16: liigesturset\n",
      "17: ei\n",
      "18: ole,\n",
      "19: k.a.\n",
      "20: MTP-des.\n",
      "21: RR\n",
      "22: 160/80\n",
      "23: mmHg,\n",
      "24: kaal\n",
      "25: 131,1\n",
      "26: kg,\n",
      "27: eutüreoidne,\n",
      "28: kilpnääre\n",
      "29: palp.tundub\n",
      "30: veidi\n",
      "31: tihedam\n",
      "32: normist,\n",
      "33: võimalik\n",
      "34: nodoosne.\n"
     ]
    }
   ],
   "source": [
    "for i, w in enumerate(text.split()):\n",
    "    print(f\"{i}: {w}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 325,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "    <style>\n",
       "    table.eli5-weights tr:hover {\n",
       "        filter: brightness(85%);\n",
       "    }\n",
       "</style>\n",
       "\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "        \n",
       "\n",
       "    \n",
       "\n",
       "        \n",
       "            \n",
       "                \n",
       "                \n",
       "    \n",
       "        <p style=\"margin-bottom: 0.5em; margin-top: 0em\">\n",
       "            <b>\n",
       "    \n",
       "        y=object\n",
       "    \n",
       "</b>\n",
       "\n",
       "    \n",
       "    (probability <b>0.999</b>, score <b>6.744</b>)\n",
       "\n",
       "top features\n",
       "        </p>\n",
       "    \n",
       "    <table class=\"eli5-weights\"\n",
       "           style=\"border-collapse: collapse; border: none; margin-top: 0em; table-layout: auto; margin-bottom: 2em;\">\n",
       "        <thead>\n",
       "        <tr style=\"border: none;\">\n",
       "            \n",
       "                <th style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\" title=\"Feature contribution already accounts for the feature value (for linear models, contribution = weight * feature value), and the sum of feature contributions is equal to the score or, for some classifiers, to the probability. Feature values are shown if &quot;show_feature_values&quot; is True.\">\n",
       "                    Contribution<sup>?</sup>\n",
       "                </th>\n",
       "            \n",
       "            <th style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">Feature</th>\n",
       "            \n",
       "        </tr>\n",
       "        </thead>\n",
       "        <tbody>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 80.00%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.758\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rr 140\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 80.87%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.650\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rahuldav 156\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 81.04%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.629\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kardiovaskulaarsüsteem rr\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 81.70%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.548\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        90 kg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 82.98%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.396\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kg kardiovaskulaarsüsteem\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 85.69%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.090\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        üldseisund rahuldav\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 86.62%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.990\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        156 cm\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 87.68%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.880\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rr\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 89.15%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.733\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 90.43%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.613\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rahuldav\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 90.59%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.599\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        reg 72\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 90.82%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.578\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        liigesturset ei\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 90.89%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.571\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        140 80\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 91.19%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.545\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        156\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 91.37%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.529\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        võimalik nodoosne\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.21%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.376\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        tundub veidi\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.31%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.368\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        x min\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.32%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.367\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rr130\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.46%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.356\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        100 mmhg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.48%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.355\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mmhg fr\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.50%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.353\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mmhg kaal\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 93.95%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.318\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mtp des\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.10%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.307\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        normist võimalik\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.44%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.283\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        ei ole\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.52%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.277\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        tihedam normist\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.60%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.271\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        72 x\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.73%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.261\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        obj liigesturset\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.74%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.261\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kilpnääre palp\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.89%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.250\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        131 1\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 94.94%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.247\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        k a\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.10%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.235\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        80 mmhg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.60%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.202\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        fr reg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.70%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.196\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        palp tundub\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.77%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.191\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mmhg obj\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.80%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.189\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        160 80\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 95.85%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.186\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kg eutüreoidne\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 96.09%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.170\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        veidi tihedam\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 96.27%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.159\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rr130 100\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 96.30%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.158\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        ole k\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 97.06%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.114\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kaal 131\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 97.13%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +0.110\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        eutüreoidne kilpnääre\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "        \n",
       "\n",
       "        \n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 98.62%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.039\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        des rr\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 97.68%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.081\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        rr 160\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 96.60%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.140\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        min rr130\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 96.44%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.149\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        tihedam\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 96.31%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.157\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        nodoosne\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 96.25%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.161\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        a\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 95.99%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.177\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kaal\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 95.92%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.181\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        160\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 95.62%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.201\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        1\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 95.38%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.217\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        fr\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.87%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.251\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        100\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.87%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.252\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        eutüreoidne\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.77%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.258\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mtp\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.75%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.260\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        tundub\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.59%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.272\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        min\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 94.39%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.286\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kilpnääre\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.74%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.334\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        des\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.72%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.336\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        131\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.61%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.344\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        palp\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.46%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.356\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        ei\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.23%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.374\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        k\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 93.10%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.384\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        normist\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 92.98%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.394\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        võimalik\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 92.41%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.440\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        obj\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 91.99%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.476\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        mmhg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 91.48%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.519\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        liigesturset\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 91.45%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.522\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        veidi\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 91.29%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.536\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        cm\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 90.09%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.645\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        80\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 89.98%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.655\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        reg\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 89.31%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.719\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        x\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 88.87%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.761\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        üldseisund\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 88.73%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.775\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        72\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 88.31%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -0.816\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        90\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 84.61%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -1.209\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        &lt;BIAS&gt;\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(0, 100.00%, 84.26%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        -1.249\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        kardiovaskulaarsüsteem\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "\n",
       "        </tbody>\n",
       "    </table>\n",
       "\n",
       "            \n",
       "        \n",
       "\n",
       "        \n",
       "\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n"
      ],
      "text/plain": [
       "Explanation(estimator=\"SGDClassifier(alpha=0.001, average=False, class_weight=None,\\n              early_stopping=False, epsilon=0.1, eta0=0.0, fit_intercept=True,\\n              l1_ratio=0.15, learning_rate='optimal', loss='log', max_iter=1000,\\n              n_iter_no_change=5, n_jobs=None, penalty='elasticnet',\\n              power_t=0.5, random_state=RandomState(MT19937) at 0x1BB79A25AE8,\\n              shuffle=True, tol=0.001, validation_fraction=0.1, verbose=0,\\n              warm_start=False)\", description=None, error=None, method='linear model', is_regression=False, targets=[TargetExplanation(target='object', feature_weights=FeatureWeights(pos=[FeatureWeight(feature='rr 140', weight=1.7579670446691162, std=None, value=1.0), FeatureWeight(feature='rahuldav 156', weight=1.649968752914558, std=None, value=1.0), FeatureWeight(feature='kardiovaskulaarsüsteem rr', weight=1.628702738446266, std=None, value=1.0), FeatureWeight(feature='90 kg', weight=1.54798896869651, std=None, value=1.0), FeatureWeight(feature='kg kardiovaskulaarsüsteem', weight=1.3960012172283318, std=None, value=1.0), FeatureWeight(feature='üldseisund rahuldav', weight=1.0901163356605912, std=None, value=1.0), FeatureWeight(feature='156 cm', weight=0.9904540895956094, std=None, value=1.0), FeatureWeight(feature='rr', weight=0.8800061809386556, std=None, value=2.0), FeatureWeight(feature='kg', weight=0.7334275946516182, std=None, value=2.0), FeatureWeight(feature='rahuldav', weight=0.6133999487702116, std=None, value=1.0), FeatureWeight(feature='reg 72', weight=0.5989501354293613, std=None, value=1.0), FeatureWeight(feature='liigesturset ei', weight=0.5781045832603571, std=None, value=1.0), FeatureWeight(feature='140 80', weight=0.571449794144677, std=None, value=1.0), FeatureWeight(feature='156', weight=0.5453628475891014, std=None, value=1.0), FeatureWeight(feature='võimalik nodoosne', weight=0.5292761972951903, std=None, value=1.0), FeatureWeight(feature='tundub veidi', weight=0.37584626918104747, std=None, value=1.0), FeatureWeight(feature='x min', weight=0.3677521242165682, std=None, value=1.0), FeatureWeight(feature='rr130', weight=0.36735382699821695, std=None, value=1.0), FeatureWeight(feature='100 mmhg', weight=0.3562058395455324, std=None, value=1.0), FeatureWeight(feature='mmhg fr', weight=0.3546028418893001, std=None, value=1.0), FeatureWeight(feature='mmhg kaal', weight=0.3526098437537956, std=None, value=1.0), FeatureWeight(feature='mtp des', weight=0.3182386111144814, std=None, value=1.0), FeatureWeight(feature='normist võimalik', weight=0.3071554788691502, std=None, value=1.0), FeatureWeight(feature='ei ole', weight=0.2827060846587643, std=None, value=1.0), FeatureWeight(feature='tihedam normist', weight=0.2766436203628976, std=None, value=1.0), FeatureWeight(feature='72 x', weight=0.2705064443989024, std=None, value=1.0), FeatureWeight(feature='obj liigesturset', weight=0.26142055552172966, std=None, value=1.0), FeatureWeight(feature='kilpnääre palp', weight=0.2609314258771324, std=None, value=1.0), FeatureWeight(feature='131 1', weight=0.24998294713363242, std=None, value=1.0), FeatureWeight(feature='k a', weight=0.24666880111107525, std=None, value=1.0), FeatureWeight(feature='80 mmhg', weight=0.23543157269789852, std=None, value=2.0), FeatureWeight(feature='fr reg', weight=0.20233119215050974, std=None, value=1.0), FeatureWeight(feature='palp tundub', weight=0.19554473672928124, std=None, value=1.0), FeatureWeight(feature='mmhg obj', weight=0.19128899413442965, std=None, value=1.0), FeatureWeight(feature='160 80', weight=0.18925863225148473, std=None, value=1.0), FeatureWeight(feature='kg eutüreoidne', weight=0.18598377197333535, std=None, value=1.0), FeatureWeight(feature='veidi tihedam', weight=0.17047054881630233, std=None, value=1.0), FeatureWeight(feature='rr130 100', weight=0.15936944939560285, std=None, value=1.0), FeatureWeight(feature='ole k', weight=0.15770090930316763, std=None, value=1.0), FeatureWeight(feature='kaal 131', weight=0.11378601066956005, std=None, value=1.0), FeatureWeight(feature='eutüreoidne kilpnääre', weight=0.10968927570231399, std=None, value=1.0)], neg=[FeatureWeight(feature='kardiovaskulaarsüsteem', weight=-1.2489033118792183, std=None, value=1.0), FeatureWeight(feature='<BIAS>', weight=-1.2094710846312458, std=None, value=1.0), FeatureWeight(feature='90', weight=-0.8158367440228163, std=None, value=1.0), FeatureWeight(feature='72', weight=-0.774588074291395, std=None, value=1.0), FeatureWeight(feature='üldseisund', weight=-0.760759552582064, std=None, value=1.0), FeatureWeight(feature='x', weight=-0.7186728945190104, std=None, value=1.0), FeatureWeight(feature='reg', weight=-0.6553605550789645, std=None, value=1.0), FeatureWeight(feature='80', weight=-0.6451219948681356, std=None, value=2.0), FeatureWeight(feature='cm', weight=-0.5360121665382612, std=None, value=1.0), FeatureWeight(feature='veidi', weight=-0.5218647766797979, std=None, value=1.0), FeatureWeight(feature='liigesturset', weight=-0.5191738147057359, std=None, value=1.0), FeatureWeight(feature='mmhg', weight=-0.4755028119607072, std=None, value=3.0), FeatureWeight(feature='obj', weight=-0.44025661578783476, std=None, value=1.0), FeatureWeight(feature='võimalik', weight=-0.3937572410709533, std=None, value=1.0), FeatureWeight(feature='normist', weight=-0.3844319368031041, std=None, value=1.0), FeatureWeight(feature='k', weight=-0.37383370652208325, std=None, value=1.0), FeatureWeight(feature='ei', weight=-0.3561533926120743, std=None, value=1.0), FeatureWeight(feature='palp', weight=-0.34419174670444663, std=None, value=1.0), FeatureWeight(feature='131', weight=-0.3361574839868134, std=None, value=1.0), FeatureWeight(feature='des', weight=-0.3344536983025916, std=None, value=1.0), FeatureWeight(feature='kilpnääre', weight=-0.28566360162447507, std=None, value=1.0), FeatureWeight(feature='min', weight=-0.27152078348439485, std=None, value=1.0), FeatureWeight(feature='tundub', weight=-0.2603343706578743, std=None, value=1.0), FeatureWeight(feature='mtp', weight=-0.25844604658620873, std=None, value=1.0), FeatureWeight(feature='eutüreoidne', weight=-0.25196090758190826, std=None, value=1.0), FeatureWeight(feature='100', weight=-0.2514062130906498, std=None, value=1.0), FeatureWeight(feature='fr', weight=-0.21668588072689504, std=None, value=1.0), FeatureWeight(feature='1', weight=-0.2009732193911436, std=None, value=1.0), FeatureWeight(feature='160', weight=-0.18135464709289278, std=None, value=1.0), FeatureWeight(feature='kaal', weight=-0.17719616130362273, std=None, value=1.0), FeatureWeight(feature='a', weight=-0.16105724584858602, std=None, value=1.0), FeatureWeight(feature='nodoosne', weight=-0.15700350107913078, std=None, value=1.0), FeatureWeight(feature='tihedam', weight=-0.14946419409350248, std=None, value=1.0), FeatureWeight(feature='min rr130', weight=-0.1399248457826685, std=None, value=1.0), FeatureWeight(feature='rr 160', weight=-0.0810125412461977, std=None, value=1.0), FeatureWeight(feature='des rr', weight=-0.03852123017676182, std=None, value=1.0)], pos_remaining=0, neg_remaining=0), proba=0.9988230217333135, score=6.743627244432101, weighted_spans=None, heatmap=None)], feature_importances=None, decision_tree=None, highlight_spaces=None, transition_features=None, image=None)"
      ]
     },
     "execution_count": 325,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "word_index = 6\n",
    "predict_func = explainer_generator.get_predict_function(word_index=word_index)\n",
    "te = TextExplainer(\n",
    "    random_state=1,\n",
    ")\n",
    "\n",
    "te.fit(text, predict_func)\n",
    "\n",
    "te.explain_prediction(\n",
    "    target_names=list(explainer_generator.idx2tag.values())\n",
    "   \n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 348,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(('Cor toonid regulaarsed . kerge süstoolne kahin . EKG regulaarne siinusrütm . Vasema vatsakese hüpertroofia . UNK 150/ 90 UNK.06.2012 - KMI 38,77, kaal 127 kg. RR UNK/100 mmHg. Kilpnääre II astmes, sõlmedega, kahinata, valutu. Jalgadel laienenud kapillaarid. . 02.02.2012 - Kaal UNK UNK 120/80mmHg Cor regul 64xmin. perif turseid ei ole. Abdominaalne rasvumine. TSH 1,34. . 29.08.2012:', 'UNK toonid regulaarsed . kerge süstoolne UNK . EKG regulaarne siinusrütm . UNK vatsakese hüpertroofia . RR 150/ 90 27.06.2012 - KMI 38,UNK, kaal 127 UNK. RR UNK/UNK mmHg. Kilpnääre II astmes, UNK, kahinata, valutu. Jalgadel laienenud kapillaarid. . 02.UNK.UNK - UNK UNK RR 120/80mmHg UNK regul 64xmin. UNK UNK ei ole. Abdominaalne rasvumine. TSH 1,34. . 29.08.2012:', 'UNK UNK UNK . UNK UNK UNK . UNK regulaarne UNK . UNK vatsakese hüpertroofia . UNK UNK/ 90 UNK.UNK.2012 - UNK UNK,UNK, UNK UNK UNK. UNK 150/UNK UNK. Kilpnääre UNK UNK, UNK, kahinata, UNK. UNK laienenud UNK. . UNK.02.UNK - UNK 98kg UNK 120/80mmHg Cor regul 64xmin. UNK UNK UNK UNK. Abdominaalne UNK. TSH 1,UNK. . UNK.08.UNK:', 'Cor UNK UNK . UNK süstoolne UNK . UNK UNK siinusrütm . UNK vatsakese UNK . UNK 150/ UNK UNK.UNK.UNK - UNK UNK,UNK, kaal 127 UNK. UNK UNK/UNK UNK. Kilpnääre UNK UNK, sõlmedega, UNK, valutu. Jalgadel UNK UNK. . 02.UNK.UNK - UNK UNK RR 120/80mmHg UNK regul 64xmin. UNK UNK UNK UNK. UNK UNK. UNK UNK,UNK. . UNK.UNK.2012:', 'Cor toonid regulaarsed . kerge süstoolne kahin . EKG UNK siinusrütm . Vasema vatsakese UNK . RR 150/ 90 UNK.06.2012 - KMI 38,77, UNK 127 kg. RR 150/UNK mmHg. UNK II astmes, sõlmedega, kahinata, valutu. Jalgadel laienenud kapillaarid. . 02.02.2012 - Kaal 98kg RR 120/80mmHg Cor regul 64xmin. UNK turseid ei ole. Abdominaalne UNK. UNK UNK,UNK. . UNK.08.2012:'), array([0.95742709, 0.86602539, 0.57735025, 0.54772254, 0.89442717]))\n"
     ]
    }
   ],
   "source": [
    "sampler = MaskingTextSampler(\n",
    "    replacement=\"UNK\",\n",
    "    max_replace=0.7,\n",
    "    token_pattern=None,\n",
    "    bow=False\n",
    ")\n",
    "print(sampler.sample_near(text, n_samples=5))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 347,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Cor toonid regulaarsed . kerge süstoolne kahin . EKG regulaarne siinusrütm . Vasema vatsakese hüpertroofia . RR 150/ 90 27.06.2012 - KMI 38,77, kaal 127 kg. RR 150/100 mmHg. Kilpnääre II astmes, sõlmedega, kahinata, valutu. Jalgadel laienenud kapillaarid. . 02.02.2012 - Kaal 98kg RR 120/80mmHg Cor regul 64xmin. perif turseid ei ole. Abdominaalne rasvumine. TSH 1,34. . 29.08.2012:\n",
      "Cor (O) toonid (O) regulaarsed (O) . (O) kerge (O) süstoolne (O) kahin (O) . (O) EKG (O) regulaarne (O) siinusrütm (O) . (O) Vasema (O) vatsakese (O) hüpertroofia (O) . (O) RR (object) 150/ (object) 90 (O) 27.06.2012 (O) - (O) KMI (O) 38,77, (O) kaal (O) 127 (O) kg. (O) RR (object) 150/100 (object) mmHg. (O) Kilpnääre (O) II (O) astmes, (O) sõlmedega, (O) kahinata, (O) valutu. (O) Jalgadel (O) laienenud (O) kapillaarid. (O) . (O) 02.02.2012 (O) - (O) Kaal (O) 98kg (O) RR (object) 120/80mmHg (object) Cor (O) regul (O) 64xmin. (O) perif (O) turseid (O) ei (O) ole. (O) Abdominaalne (O) rasvumine. (O) TSH (O) 1,34. (O) . (O) 29.08.2012: (O)\n",
      "0: Cor\n",
      "1: toonid\n",
      "2: regulaarsed\n",
      "3: .\n",
      "4: kerge\n",
      "5: süstoolne\n",
      "6: kahin\n",
      "7: .\n",
      "8: EKG\n",
      "9: regulaarne\n",
      "10: siinusrütm\n",
      "11: .\n",
      "12: Vasema\n",
      "13: vatsakese\n",
      "14: hüpertroofia\n",
      "15: .\n",
      "16: RR\n",
      "17: 150/\n",
      "18: 90\n",
      "19: 27.06.2012\n",
      "20: -\n",
      "21: KMI\n",
      "22: 38,77,\n",
      "23: kaal\n",
      "24: 127\n",
      "25: kg.\n",
      "26: RR\n",
      "27: 150/100\n",
      "28: mmHg.\n",
      "29: Kilpnääre\n",
      "30: II\n",
      "31: astmes,\n",
      "32: sõlmedega,\n",
      "33: kahinata,\n",
      "34: valutu.\n",
      "35: Jalgadel\n",
      "36: laienenud\n",
      "37: kapillaarid.\n",
      "38: .\n",
      "39: 02.02.2012\n",
      "40: -\n",
      "41: Kaal\n",
      "42: 98kg\n",
      "43: RR\n",
      "44: 120/80mmHg\n",
      "45: Cor\n",
      "46: regul\n",
      "47: 64xmin.\n",
      "48: perif\n",
      "49: turseid\n",
      "50: ei\n",
      "51: ole.\n",
      "52: Abdominaalne\n",
      "53: rasvumine.\n",
      "54: TSH\n",
      "55: 1,34.\n",
      "56: .\n",
      "57: 29.08.2012:\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "\n",
       "    <style>\n",
       "    table.eli5-weights tr:hover {\n",
       "        filter: brightness(85%);\n",
       "    }\n",
       "</style>\n",
       "\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "        \n",
       "\n",
       "    \n",
       "\n",
       "        \n",
       "\n",
       "        \n",
       "    \n",
       "        \n",
       "        \n",
       "    \n",
       "        <p style=\"margin-bottom: 0.5em; margin-top: 0em\">\n",
       "            <b>\n",
       "    \n",
       "        y=O\n",
       "    \n",
       "</b>\n",
       "\n",
       "    \n",
       "    (probability <b>0.998</b>, score <b>-6.423</b>)\n",
       "\n",
       "top features\n",
       "        </p>\n",
       "    \n",
       "    <table class=\"eli5-weights\"\n",
       "           style=\"border-collapse: collapse; border: none; margin-top: 0em; table-layout: auto; margin-bottom: 2em;\">\n",
       "        <thead>\n",
       "        <tr style=\"border: none;\">\n",
       "            \n",
       "                <th style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\" title=\"Feature contribution already accounts for the feature value (for linear models, contribution = weight * feature value), and the sum of feature contributions is equal to the score or, for some classifiers, to the probability. Feature values are shown if &quot;show_feature_values&quot; is True.\">\n",
       "                    Contribution<sup>?</sup>\n",
       "                </th>\n",
       "            \n",
       "            <th style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">Feature</th>\n",
       "            \n",
       "        </tr>\n",
       "        </thead>\n",
       "        <tbody>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 80.00%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +4.461\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        Highlighted in text (sum)\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "            <tr style=\"background-color: hsl(120, 100.00%, 88.74%); border: none;\">\n",
       "    <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "        +1.963\n",
       "    </td>\n",
       "    <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "        &lt;BIAS&gt;\n",
       "    </td>\n",
       "    \n",
       "</tr>\n",
       "        \n",
       "        \n",
       "\n",
       "        \n",
       "        \n",
       "\n",
       "        </tbody>\n",
       "    </table>\n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n",
       "    <p style=\"margin-bottom: 2.5em; margin-top:-0.5em;\">\n",
       "        <span style=\"opacity: 0.80\">Cor toonid regulaarsed . kerge </span><span style=\"background-color: hsl(120, 100.00%, 98.72%); opacity: 0.80\" title=\"0.016\">süstoolne</span><span style=\"opacity: 0.80\"> kahin . </span><span style=\"background-color: hsl(120, 100.00%, 97.33%); opacity: 0.80\" title=\"0.046\">EKG</span><span style=\"opacity: 0.80\"> regulaarne siinusrütm . Vasema vatsakese hüpertroofia . </span><span style=\"background-color: hsl(120, 100.00%, 98.91%); opacity: 0.80\" title=\"0.013\">RR</span><span style=\"opacity: 0.80\"> 150/ 90 </span><span style=\"background-color: hsl(120, 100.00%, 97.49%); opacity: 0.80\" title=\"0.042\">27</span><span style=\"opacity: 0.80\">.</span><span style=\"background-color: hsl(120, 100.00%, 94.37%); opacity: 0.81\" title=\"0.133\">06</span><span style=\"opacity: 0.80\">.2012 - KMI 38,77, </span><span style=\"background-color: hsl(120, 100.00%, 96.05%); opacity: 0.81\" title=\"0.080\">kaal</span><span style=\"opacity: 0.80\"> 127 kg. </span><span style=\"background-color: hsl(120, 100.00%, 93.44%); opacity: 0.82\" title=\"0.165\">RR</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 95.71%); opacity: 0.81\" title=\"0.090\">150</span><span style=\"opacity: 0.80\">/</span><span style=\"background-color: hsl(120, 100.00%, 96.76%); opacity: 0.81\" title=\"0.060\">100</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 84.89%); opacity: 0.85\" title=\"0.543\">mmHg</span><span style=\"opacity: 0.80\">. </span><span style=\"background-color: hsl(120, 100.00%, 92.87%); opacity: 0.82\" title=\"0.186\">Kilpnääre</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 91.80%); opacity: 0.82\" title=\"0.227\">II</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(0, 100.00%, 91.51%); opacity: 0.82\" title=\"-0.239\">astmes</span><span style=\"opacity: 0.80\">, sõlmedega, </span><span style=\"background-color: hsl(120, 100.00%, 90.90%); opacity: 0.82\" title=\"0.263\">kahinata</span><span style=\"opacity: 0.80\">, </span><span style=\"background-color: hsl(120, 100.00%, 60.00%); opacity: 1.00\" title=\"2.184\">valutu</span><span style=\"opacity: 0.80\">. </span><span style=\"background-color: hsl(0, 100.00%, 99.37%); opacity: 0.80\" title=\"-0.006\">Jalgadel</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(0, 100.00%, 86.59%); opacity: 0.84\" title=\"-0.459\">laienenud</span><span style=\"opacity: 0.80\"> kapillaarid. . </span><span style=\"background-color: hsl(120, 100.00%, 96.69%); opacity: 0.81\" title=\"0.062\">02</span><span style=\"opacity: 0.80\">.02.2012 - </span><span style=\"background-color: hsl(0, 100.00%, 97.01%); opacity: 0.80\" title=\"-0.054\">Kaal</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 96.30%); opacity: 0.81\" title=\"0.073\">98kg</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 97.80%); opacity: 0.80\" title=\"0.035\">RR</span><span style=\"opacity: 0.80\"> 120/</span><span style=\"background-color: hsl(120, 100.00%, 95.15%); opacity: 0.81\" title=\"0.107\">80mmHg</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 95.79%); opacity: 0.81\" title=\"0.088\">Cor</span><span style=\"opacity: 0.80\"> regul 64xmin. </span><span style=\"background-color: hsl(120, 100.00%, 95.77%); opacity: 0.81\" title=\"0.088\">perif</span><span style=\"opacity: 0.80\"> turseid ei ole. </span><span style=\"background-color: hsl(120, 100.00%, 98.35%); opacity: 0.80\" title=\"0.023\">Abdominaalne</span><span style=\"opacity: 0.80\"> rasvumine. </span><span style=\"background-color: hsl(120, 100.00%, 97.49%); opacity: 0.80\" title=\"0.042\">TSH</span><span style=\"opacity: 0.80\"> </span><span style=\"background-color: hsl(120, 100.00%, 96.25%); opacity: 0.81\" title=\"0.074\">1</span><span style=\"opacity: 0.80\">,34. . </span><span style=\"background-color: hsl(120, 100.00%, 94.21%); opacity: 0.81\" title=\"0.138\">29</span><span style=\"opacity: 0.80\">.08.</span><span style=\"background-color: hsl(120, 100.00%, 98.79%); opacity: 0.80\" title=\"0.015\">2012</span><span style=\"opacity: 0.80\">:</span>\n",
       "    </p>\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n"
      ],
      "text/plain": [
       "Explanation(estimator=\"SGDClassifier(alpha=0.001, average=False, class_weight=None,\\n              early_stopping=False, epsilon=0.1, eta0=0.0, fit_intercept=True,\\n              l1_ratio=0.15, learning_rate='optimal', loss='log', max_iter=1000,\\n              n_iter_no_change=5, n_jobs=None, penalty='elasticnet',\\n              power_t=0.5, random_state=RandomState(MT19937) at 0x1BB731FF8C8,\\n              shuffle=True, tol=0.001, validation_fraction=0.1, verbose=0,\\n              warm_start=False)\", description=None, error=None, method='linear model', is_regression=False, targets=[TargetExplanation(target='O', feature_weights=FeatureWeights(pos=[FeatureWeight(feature='[33] valutu', weight=2.184242719103973, std=None, value=1.0), FeatureWeight(feature='<BIAS>', weight=1.9628294429127104, std=None, value=1.0), FeatureWeight(feature='[27] mmHg', weight=0.5433820658751116, std=None, value=1.0), FeatureWeight(feature='[24] RR', weight=0.4949546378952012, std=None, value=1.0), FeatureWeight(feature='[32] kahinata', weight=0.2632544206217954, std=None, value=1.0), FeatureWeight(feature='[29] II', weight=0.22715817510002065, std=None, value=1.0), FeatureWeight(feature='[28] Kilpnääre', weight=0.18587953733543655, std=None, value=1.0), FeatureWeight(feature='[57] 29', weight=0.13824012982467873, std=None, value=1.0), FeatureWeight(feature='[16] 06', weight=0.13275341573975807, std=None, value=1.0), FeatureWeight(feature='[44] 80mmHg', weight=0.1072328779149954, std=None, value=1.0), FeatureWeight(feature='[42] RR', weight=0.10372598122700454, std=None, value=1.0), FeatureWeight(feature='[25] 150', weight=0.08999337345395425, std=None, value=1.0), FeatureWeight(feature='[48] perif', weight=0.08833549359763983, std=None, value=1.0), FeatureWeight(feature='[45] Cor', weight=0.08753253234463933, std=None, value=1.0), FeatureWeight(feature='[21] kaal', weight=0.07997006578756874, std=None, value=1.0), FeatureWeight(feature='[55] 1', weight=0.07414292286323476, std=None, value=1.0), FeatureWeight(feature='[41] 98kg', weight=0.07272340013501176, std=None, value=1.0), FeatureWeight(feature='[37] 02', weight=0.06212094826895249, std=None, value=1.0), FeatureWeight(feature='[26] 100', weight=0.06026566547441532, std=None, value=1.0), FeatureWeight(feature='[6] EKG', weight=0.04579111630145259, std=None, value=1.0), FeatureWeight(feature='[54] TSH', weight=0.04190584455664974, std=None, value=1.0), FeatureWeight(feature='[15] 27', weight=0.04180123449906112, std=None, value=1.0), FeatureWeight(feature='[12] RR', weight=0.03827291360076936, std=None, value=1.0), FeatureWeight(feature='[52] Abdominaalne', weight=0.02291671981145091, std=None, value=1.0), FeatureWeight(feature='[4] süstoolne', weight=0.01595176715366844, std=None, value=1.0), FeatureWeight(feature='[59] 2012', weight=0.01473565759509571, std=None, value=1.0)], neg=[FeatureWeight(feature='[35] laienenud', weight=-0.45853211991525167, std=None, value=1.0), FeatureWeight(feature='[30] astmes', weight=-0.23864879679831716, std=None, value=1.0), FeatureWeight(feature='[40] Kaal', weight=-0.05366076219081095, std=None, value=1.0), FeatureWeight(feature='[34] Jalgadel', weight=-0.005788023982564124, std=None, value=1.0)], pos_remaining=0, neg_remaining=0), proba=0.9983796369232394, score=-6.4234833561073055, weighted_spans=WeightedSpans(docs_weighted_spans=[DocWeightedSpans(document='Cor toonid regulaarsed . kerge süstoolne kahin . EKG regulaarne siinusrütm . Vasema vatsakese hüpertroofia . RR 150/ 90 27.06.2012 - KMI 38,77, kaal 127 kg. RR 150/100 mmHg. Kilpnääre II astmes, sõlmedega, kahinata, valutu. Jalgadel laienenud kapillaarid. . 02.02.2012 - Kaal 98kg RR 120/80mmHg Cor regul 64xmin. perif turseid ei ole. Abdominaalne rasvumine. TSH 1,34. . 29.08.2012:', spans=[('süstoolne', [(31, 40)], 0.01595176715366844), ('EKG', [(49, 52)], 0.04579111630145259), ('RR', [(109, 111)], 0.03827291360076936), ('27', [(120, 122)], 0.04180123449906112), ('06', [(123, 125)], 0.13275341573975807), ('kaal', [(144, 148)], 0.07997006578756874), ('RR', [(157, 159)], 0.4949546378952012), ('150', [(160, 163)], 0.08999337345395425), ('100', [(164, 167)], 0.06026566547441532), ('mmHg', [(168, 172)], 0.5433820658751116), ('Kilpnääre', [(174, 183)], 0.18587953733543655), ('II', [(184, 186)], 0.22715817510002065), ('astmes', [(187, 193)], -0.23864879679831716), ('kahinata', [(206, 214)], 0.2632544206217954), ('valutu', [(216, 222)], 2.184242719103973), ('Jalgadel', [(224, 232)], -0.005788023982564124), ('laienenud', [(233, 242)], -0.45853211991525167), ('02', [(258, 260)], 0.06212094826895249), ('Kaal', [(271, 275)], -0.05366076219081095), ('98kg', [(276, 280)], 0.07272340013501176), ('RR', [(281, 283)], 0.10372598122700454), ('80mmHg', [(288, 294)], 0.1072328779149954), ('Cor', [(295, 298)], 0.08753253234463933), ('perif', [(313, 318)], 0.08833549359763983), ('Abdominaalne', [(335, 347)], 0.02291671981145091), ('TSH', [(359, 362)], 0.04190584455664974), ('1', [(363, 364)], 0.07414292286323476), ('29', [(371, 373)], 0.13824012982467873), ('2012', [(377, 381)], 0.01473565759509571)], preserve_density=False, vec_name=None)], other=FeatureWeights(pos=[FeatureWeight(feature=<FormattedFeatureName 'Highlighted in text (sum)'>, weight=4.460653913194595, std=None, value=None), FeatureWeight(feature='<BIAS>', weight=1.9628294429127104, std=None, value=1.0)], neg=[], pos_remaining=0, neg_remaining=0)), heatmap=None)], feature_importances=None, decision_tree=None, highlight_spaces=None, transition_features=None, image=None)"
      ]
     },
     "execution_count": 347,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "label = labels[105:109]\n",
    "text = sentences[105:109]\n",
    "text = \" \".join(str(x) for x in text)\n",
    "label = [' '.join(x) for x in label]\n",
    "label = \" \".join(str(x) for x in label)\n",
    "print(text)\n",
    "print(\" \".join([f\"{t} ({l})\" for t, l in zip(text.split(), label.split())]))\n",
    "\n",
    "for i, w in enumerate(text.split()):\n",
    "    print(f\"{i}: {w}\")\n",
    "    \n",
    "word_index =26\n",
    "predict_func = explainer_generator.get_predict_function(word_index=word_index)\n",
    "\n",
    "te = TextExplainer(\n",
    "    sampler=sampler,\n",
    "    position_dependent=True,\n",
    "    random_state=1,\n",
    "#     char_based =True #True if explanation should be char-based, False if it should be token-based. Default is False.\n",
    ")\n",
    "\n",
    "te.fit(text, predict_func)\n",
    "\n",
    "te.explain_prediction(\n",
    "    target_names=list(explainer_generator.idx2tag.values())\n",
    "   \n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 335,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'mean_KL_divergence': 0.020141607496157836, 'score': 0.9689993641457333}"
      ]
     },
     "execution_count": 335,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "te.metrics_\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 336,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "SGDClassifier(alpha=0.001, average=False, class_weight=None,\n",
       "              early_stopping=False, epsilon=0.1, eta0=0.0, fit_intercept=True,\n",
       "              l1_ratio=0.15, learning_rate='optimal', loss='log', max_iter=1000,\n",
       "              n_iter_no_change=5, n_jobs=None, penalty='elasticnet',\n",
       "              power_t=0.5, random_state=RandomState(MT19937) at 0x1BB798A87B8,\n",
       "              shuffle=True, tol=0.001, validation_fraction=0.1, verbose=0,\n",
       "              warm_start=False)"
      ]
     },
     "execution_count": 336,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "te.clf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 350,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "SingleDocumentVectorizer(token_pattern='(?u)\\\\b\\\\w+\\\\b')"
      ]
     },
     "execution_count": 350,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "te.vec_"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### In this example both accuracy and KL divergence are good; it means our white-box classifier usually assigns the same labels as the black-box classifier on the dataset we generated, and its predicted probabilities are close to those predicted by our NN model. So it is likelythat the explanation is correct and can be trusted."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
